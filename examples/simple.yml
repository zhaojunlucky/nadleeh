name: "test"

working-dir: /Users/jun/Downloads
env:
  BACK_BASE_DIR: ~/backup

jobs:
  os-info:
    steps:
      - name: get date
        id: date
        script: |
          const curDate = new Date()
          const dateStr = curDate.toISOString().replaceAll(":", "_")
          console.log(JSON.stringify(env.getAll()))
          env.set('BACK_DIR', `${env.get('BACK_BASE_DIR')}/${dateStr}`)
          env.set('DATE_STR', dateStr)
      - run: |
          # printenv
          # ls ~
          if [[ -z "$BACK_DIR" ]]; then
            echo "BACK_DIR is empty"
            exit 1
          else
            echo "BACK_DIR is $BACK_DIR"
          fi
          
          if [[ -z "DATE_STR" ]]; then
            echo "DATE_STR is empty"
            exit 1
          else
            echo "DATE_STR is $DATE_STR"
          fi
          PG=$BACK_DIR/PG
          cat bbb.zz || echo "no bbb"
          echo "back dir is $PG"
          echo "=====end======="

      - name: js plugin test
        uses: js-plug@latest
        plugin-path: /Users/jun/magicworldz/github/nadleehz/js-plug-example
        with:
          data: this is data

